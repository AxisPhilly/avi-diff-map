<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" href="css/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="css/leaflet.ie.css" />
    <![endif]-->
    <link rel="stylesheet" href="css/app.css" type="text/css">
  </head>
  <body>
    <header>
      <div id="show" class="toggle container"><i>&#8615</i> Expand</div>
      <div id="info" class="container">
        <h2>New vs Old: AVI Changes</h2>
        <div id="hide" class="toggle"><i>&#8613</i> Collapse</div>
        <p class="description">
          The City of Philadelphia has just finished a massive reassessment of every property
          in the City. This map shows the percent change in property tax between 2013 and 2014,
          assuming a 1.25% tax rate.
        </p>
        <hr>
        <p>Search for a Philadelphia address: </p>
        <form id="geocoder"></form>
        <hr>
        <p class="note"><em>Note: Parcels with exemptions and parcels that could not accurately be matched to a
        tax record are not displayed on this map.</em></p>
      </div>
      <div id="tooltip" class="container">

      </div>
    </header>
    <section>
      <div id="map"></div>
    </section>
    <footer>
      <div id="logo" class="container">
        <a href="http://www.axisphilly.org" target="_blank"> </a>
      </div>
    </footer>
    <script type="text/javascript" src="js/leaflet.js"></script>
    <script type="text/javascript" src="js/wax.leaf.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="js/jquery.geocodify.js"></script>
    <script type="text/javascript" src="js/purl.js"></script>
    <script type="text/javascript" src="js/underscore.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
          // Setup geocoding
          $("#geocoder").geocodify({
            onSelect: function (result) { 
              app.map
                .panTo(new L.LatLng(result.geometry.location.Ya, result.geometry.location.Za))
                .setZoom(17);
            },
            viewportBias: new google.maps.LatLngBounds(
             new google.maps.LatLng(39.884, -75.318),
             new google.maps.LatLng(40.130, -74.881)
            ) 
          });

          // Bind toggle
          $("#hide").click(function(){
            $(".description").slideUp();
            $(".note").slideUp();
            $("#show").show();
          })

          $("#show").click(function(){
            $(".description").slideDown();
            $(".note").slideDown();
            $("#show").hide();
          });

          // Default settings. Overridden by URL params, if they exist
          app.opts = {
            mapContainer: 'map',
            tileURL: 'http://api.tiles.mapbox.com/v3/axisphilly.map-g7vghdzl.jsonp',
            mapOptions: {
              center: [39.99, -75.150],
              zoom: 12,
              minZoom: 11,
              maxZoom: 18,
              maxBounds: [
                [39.69, -76.20],
                [40.60, -74.14]
              ]
            }
          }

          // Kick off map
          app.initMap(function() {
            app.map.attributionControl.addAttribution(
              'Map Data: City of Philadelphia; ' +
              'Basemap Data: (c) <a href="http://www.openstreetmap.org">OpenStreetMap</a>; ' + 
              'Colors: <a href="http://colorbrewer2.org/">ColorBrewer.org</a>'
            );

            /*L.tileLayer('http://0.0.0.0:8000/{z}/{x}/{y}.png', {}).addTo(app.map);

            wax.leaf.interaction()
              .map(app.map)
              .tilejson({
                  tilejson: '1.0.0',
                  tiles: [ 'http://0.0.0.0:8000/{z}/{x}/{y}.png' ],
                  grids: [ 'http://0.0.0.0:8000/{z}/{x}/{y}.grid.json' ],
                  template: "{{#__teaser__}}{{address}}{{/__teaser__}}",
                  name: 'foo'
                }
              )
              .on({
                on: function(o){ 
                  $('#tooltip').html(
                    "<strong>" + o.data.address + "</strong><br>"
                    + "Current Assessment: " + o.data.old_mv
                  );
                },
                off: function(o) {
                  //$('#tooltip').hide();
                }
              });*/
          });
        });
    </script>
  </body>
</html>